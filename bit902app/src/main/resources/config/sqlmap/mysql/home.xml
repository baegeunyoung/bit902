<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.smartpayapp.repository.mapper.HomeMapper">

	<resultMap type="EventVO" id="eventMap">
		<result column="event_no" property="eventNo"/>
		<result column="event_content" property="eventContent"/>
		<result column="seller_no" property="sellerNo"/>
	</resultMap>
	
	<resultMap type="HomeEventInfoVO" id="homeEventInfoMap">
		<result column="name" property="storeName"/>
		<result column="event_title" property="eventTitle"/>
		<result column="event_content" property="eventContent"/>
		<result column="system_name" property="systemName"/>
		<result column="file_path" property="filePath"/>
	</resultMap>
	
	<resultMap type="StoreVO" id="storeMap">
		<result column="store_no" property="storeNo"/>
		<result column="name" property="name"/>
		<result column="adress" property="adress"/>
		<result column="latitude" property="latitude"/>
		<result column="longitude" property="longitude"/>
		<result column="seller_no" property="sellerNo"/>
		<result column="conent" property="content"/>
		<result column="file_path" property="filePath"/>
		<result column="system_name" property="systemName"/>
	</resultMap>

	<insert id="insertEvent" parameterType="EventVO">
		insert into tb_event(event_content, seller_no)
		values(#{eventContent}, #{sellerNo})
	</insert>
	
	<select id="readEvent" parameterType="int"  resultMap="eventMap">
		select *
			from tb_event
			where seller_no = #{sellerNo}
	</select>
	
	<delete id="eventDelete" parameterType="int">
		delete
			from tb_event
			where seller_no = #{sellerNo}
	</delete>
	
	<update id="eventModify" parameterType="EventVO">
		update tb_event
			set event_content = #{eventContent}
			where seller_no = #{sellerNo}
	</update>
	
	<!-- //앱 홈화면에 이벤트정보 가져오기 -->
	<select id="selectHomeEventInfo" resultMap="homeEventInfoMap">
		select 	e.event_title,
				e.event_content, 
				s.name, 
				sf.file_path, 
				sf.system_name
		from tb_event e
		inner join tb_store s
			on e.seller_no = s.seller_no
		inner join tb_store_file sf
			on e.seller_no = sf.seller_no and sf.event_no is not null
		order by e.event_no desc limit 10
	</select>

	<!-- //앱 홈화면에 상점검색결과 가져오기 -->
	<select id="selectHomeSearch" resultMap="storeMap">
		select 	s.name,
				s.adress, 
				s.latitude, 
				s.longitude, 
				s.seller_no,
				s.content,
				sf.file_path,
				sf.system_name
		from tb_store s
		inner join tb_store_file sf
				on s.seller_no = sf.seller_no and sf.store_no is not null
		where name like concat('%', #{name},  '%')
	</select>
</mapper>