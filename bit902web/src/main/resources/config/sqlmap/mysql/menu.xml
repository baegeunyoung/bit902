<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.smartpayweb.repository.mapper.MenuMapper">
	
	<resultMap id="menuMap" type="MenuVO" >
		<result property="menuNo" column="menu_no"/>
		<result property="storeNo" column="store_no"/>
		<result property="sellerNo" column="seller_no"/>
		<result property="name" column="name"/>
		<result property="size" column="size"/>
		<result property="price" column="price"/>
		<result property="content" column="content"/>
	</resultMap>
<!--	
	 <select id="getStoreByStoreNo" resultMap="menuMap">
    	select m.name, 
    		   m.content,
    		   m.price,
    		   m.size
    	  from tb_menu m inner join 
    	       tb_store s
    		on m.store_no = s.store_no
    	  where m.store_no = #{store_no}
    	 order by m.name desc 	 
    </select>
  -->
  
  	<select id="getStoreByStoreNo"  parameterType="int" resultMap="menuMap">
    	select m.name, 
    		   m.content,
    		   m.price,
    		   m.size
    	  from tb_menu m
    inner join tb_store st
    		on m.store_no = st.store_no
    inner join tb_seller se
    		on st.seller_no = se.seller_no
    where m.seller_no = #{sellerNo}
    </select>
    	   
<!--     	 order by name desc 	  -->
	    
	<insert id="insertMenu" parameterType="MenuVO">
	    <selectKey keyProperty="menuNo" order="AFTER" resultType="int">
	        select last_insert_id()
	    </selectKey>        
		insert into tb_menu(
		   	store_no,
		   	seller_no,
		   	name,
		   	size,
		   	price,
		    content
		) values (
			8,
			#{sellerNo},
		    #{name},
		    #{size},
		    #{price},
		    #{content}
		)    
    </insert>
   
	
	
   <!--  파일 -->
     <resultMap id="menuFileMap" type="StoreFileVO" >
		<result property="storeFileNo" column="store_file_no"/>
		<result property="storeNo" column="store_no"/>
		<result property="menuNo" column="menu_no"/>
		<result property="oriName" column="ori_name"/>
		<result property="systemName" column="system_name"/>
		<result property="filePath" column="file_path"/>
		<result property="fileSize" column="file_size"/>
	</resultMap>
 <!--  
    <select id="selectStoreFileByNo" parameterType="int" resultMap="menuFileMap">
	    select sf.store_file_no,
	           sf.menu_no,
	           sf.file_path,
	           sf.store_no
	      from tb_store_file sf inner join
	      	   tb_store s
	     	on sf.store_no = s.store_no
	     where sf.store_no = #{storeNo}      
	</select>  
 -->    
 
	 <select id="selectStoreFileByNo" parameterType="int" resultMap="menuFileMap">
	    select store_file_no,
	           menu_no,
	           file_path,
	           store_no
	      from tb_store_file 
<!-- 	     where store_no = #{storeNo}       -->
	</select>  
  <insert id="insertMenuFile" parameterType="StoreFileVO">
		insert into tb_store_file (
			menu_no,         
			ori_name, 
			system_name, 
			file_path, 
			file_size
		) values (
			#{menuNo}, 
			#{oriName}, 
			#{systemName},
			#{filePath}, 
			#{fileSize}		
		)
	</insert>
	
	
	
	    
	    
	    
</mapper>